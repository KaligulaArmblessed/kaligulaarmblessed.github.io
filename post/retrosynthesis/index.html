<!DOCTYPE html>
<html lang="en"><head>
    <title>Kernels and Cats</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://kaligulaarmblessed.github.io/favicon.ico">
    <link rel="canonical" href="https://kaligulaarmblessed.github.io">
    
    
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://kaligulaarmblessed.github.io">Kernels and Cats</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/about/">
                                    
                                    <span>About</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/post/">
                                    
                                    <span>All posts</span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>Retrosynthesis - Thu, Dec 1, 2022</h1>
    </div>
    <p class="lead"></p>
    <h2 id="retrosynthesis-idekctf-2021-d">Retrosynthesis (idekCTF 2021 :D)</h2>
<h4 id="tldr">TLDR</h4>
<p>Disassembling the binary will show that each of the &ldquo;reagents&rdquo; is tied to a function, which performs a specific mathematical operation with certain numbers as specified in the functions. The &ldquo;reaction&rdquo; proceeds as the starting material (also a number) undergoes these operations depending on whether the functions are activated. In order to synthesize the &ldquo;final product&rdquo;, cubane (in this case, also a number), the correct operations have to be activated. This can be done by patching the binary (e.g. using radare2). The functions that have to be activated to generate the final product are: NBS, Diels-Alder, SOCl2, Favorskii.</p>
<h4 id="introduction">Introduction</h4>
<p>When we run the binary, we get:</p>
<pre tabindex="0"><code>./retrosynthesis   
    ____       __                              __  __              _     
   / __ \___  / /__________  _______  ______  / /_/ /_  ___  _____(_)____
  / /_/ / _ \/ __/ ___/ __ \/ ___/ / / / __ \/ __/ __ \/ _ \/ ___/ / ___/
 / _, _/  __/ /_/ /  / /_/ (__  ) /_/ / / / / /_/ / / /  __(__  ) (__  ) 
/_/ |_|\___/\__/_/   \____/____/\__, /_/ /_/\__/_/ /_/\___/____/_/____/  
                               /____/                                    
-------------------------------------------------------------------------
Note: You do not need to know Chemistry to do this challenge, though it will help :)
---------------------------------STATUS----------------------------------
Math: 28550354772583778 [Not done] | Chem: Benzene [Not added]
Math: 5456462 [Not done] | Chem: NBS [Not added]
Math: 495739824484 [Not done] | Chem: Diels-Alder Reaction [Not done]
Math: 216564715347 [Not done] | Chem: SOCl2 [Not added]
Math: 310568239917 [Not done] | Chem: Decarboxylation [Not done]
Math: 465725320289 [Not done] | Chem: Aldol Reaction [Not done]
Math: 87492136360x0000172e430815590 [Not done] | Chem: Favorskii Reaction [Not done]
---------------------------------RESULTS---------------------------------
Starting material: 8749110455712246664
Desired product: 111524754650467 Cubane
Obtained product: 8749110455712246664
-------------------------------------------------------------------------
You did not synthesize the final product! Synthesis failed. :(
-------------------------------------------------------------------------
</code></pre><p>Oh no! Our synthesis failed! But there does not seem to be a way to input steps or reagents into the binary. Let&rsquo;s disassemble it with r2. Taking a look at the functions that we have:</p>
<pre tabindex="0"><code>r2 -d retrosynthesis
...
[0x7faecf103050]&gt; aaa
...
[0x7faecf103050]&gt; afl
0x55cb85b3d0e0    1 42           entry0
0x55cb85b40fe0    4 4124 -&gt; 4135 reloc.__libc_start_main
0x55cb85b3d110    4 41   -&gt; 34   sym.deregister_tm_clones
0x55cb85b3d140    4 57   -&gt; 51   sym.register_tm_clones
0x55cb85b3d180    5 57   -&gt; 54   sym.__do_global_dtors_aux
0x55cb85b3d0d0    1 6            sym.imp.__cxa_finalize
0x55cb85b3d1c0    1 9            entry.init0
0x55cb85b3d000    3 23           map._home_calsx_Downloads_CTF_idekctf_retrosynthesis_Retrosynthesis_retrosynthesis.r_x
0x55cb85b3d66c    1 22           sym.NBS
0x55cb85b3dd10    1 1            sym.__libc_csu_fini
0x55cb85b3d6ba    1 28           sym.decarb
0x55cb85b3dd14    1 9            sym._fini
0x55cb85b3d650    1 28           sym.benzene
0x55cb85b3d6f2    1 28           sym.favorsky
0x55cb85b3d6d6    1 28           sym.aldol
0x55cb85b3d69e    1 28           sym.SOCl2
0x55cb85b3d1c9   10 254          sym.str2md5
0x55cb85b3dcb0    4 93           sym.__libc_csu_init
0x55cb85b3d682    1 28           sym.diels
0x55cb85b3d2c7    1 84           sym.compute_md5
0x55cb85b3d0c0    1 6            sym.imp.MD5_Init
0x55cb85b3d080    1 6            sym.imp.strlen
0x55cb85b3d0a0    1 6            sym.imp.MD5_Update
0x55cb85b3d090    1 6            sym.imp.MD5_Final
0x55cb85b3d70e   31 1429         main
0x55cb85b3d030    1 6            sym.imp.printf
0x55cb85b3d040    1 6            sym.imp.snprintf
0x55cb85b3d050    1 6            sym.imp.puts
0x55cb85b3d060    1 6            sym.imp.putchar
0x55cb85b3d070    1 6            sym.imp.malloc
0x55cb85b3c000    3 126  -&gt; 181  loc.imp.__gmon_start__
0x55cb85b3d0b0    1 6            sym.imp.sprintf
</code></pre><p>Taking a look at the very long main function, we see that there is a huge chunk of variables being defined on top&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d70e</span>      <span style="color:#ae81ff">55</span>             <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d70f</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">e5</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d712</span>      <span style="color:#ae81ff">4881</span><span style="color:#66d9ef">ec000100.</span>  <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x100</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d719</span>      <span style="color:#ae81ff">48</span><span style="color:#66d9ef">b8886b62cd.</span>  <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x796b159acd626b88</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d723</span>      <span style="color:#ae81ff">488945</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d727</span>      <span style="color:#66d9ef">c745e4000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_1ch</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d72e</span>      <span style="color:#66d9ef">c745e0000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d735</span>      <span style="color:#66d9ef">c745dc000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_24h</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d73c</span>      <span style="color:#66d9ef">c745d8000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_28h</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d743</span>      <span style="color:#66d9ef">c745d4000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_2ch</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d74a</span>      <span style="color:#66d9ef">c745d0000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_30h</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d751</span>      <span style="color:#66d9ef">c745cc000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_34h</span>], <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>&hellip;And that there is some sort of function where the value of these variables is compared to 1. If the value of the variable equals to 1, some function will be activated, and the functions seem to be our &ldquo;reagents&rdquo; in this synthesis (in this case, the benzene function):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7df</span>      <span style="color:#ae81ff">837</span><span style="color:#66d9ef">de401</span>       <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_1ch</span>], <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">┌─&lt;</span> <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7e3</span>      <span style="color:#ae81ff">7521</span>           <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x55cb85b3d806</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7e5</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">b45f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7e9</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">c7</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7ec</span>      <span style="color:#66d9ef">e85ffeffff</span>     <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">sym.benzene</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7f1</span>      <span style="color:#ae81ff">488945</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7f5</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">d05ec0a00.</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">str.Math</span>:<span style="color:#66d9ef">_28550354772583778__Done___Chem</span>:<span style="color:#66d9ef">_Benzene__Added_</span> <span style="color:#75715e">; 0x55cb85b3e2e8 ; &#34;Math: 28550354772583778 [Done] | Chem: Benzene [Added]&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7fc</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">c7</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d7ff</span>      <span style="color:#66d9ef">e84cf8ffff</span>     <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">sym.imp.puts</span>       <span style="color:#75715e">; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>      <span style="color:#960050;background-color:#1e0010">┌──&lt;</span> <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d804</span>      <span style="color:#66d9ef">eb0f</span>           <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x55cb85b3d815</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>      <span style="color:#960050;background-color:#1e0010">│└─&gt;</span> <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d806</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">d05130b00.</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">str.Math</span>:<span style="color:#66d9ef">_28550354772583778__Not_done___Chem</span>:<span style="color:#66d9ef">_Benzene__Not_added_</span> <span style="color:#75715e">; 0x55cb85b3e320 ; &#34;Math: 28550354772583778 [Not done] | Chem: Benzene [Not added]&#34;                                                                                                                                                                               
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>      <span style="color:#960050;background-color:#1e0010">│</span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d80d</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">c7</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>      <span style="color:#960050;background-color:#1e0010">│</span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d810</span>      <span style="color:#66d9ef">e83bf8ffff</span>     <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">sym.imp.puts</span>       <span style="color:#75715e">; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>      <span style="color:#960050;background-color:#1e0010">│</span>    <span style="color:#75715e">; CODE XREF from main @ 0x55cb85b3d804
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>      <span style="color:#960050;background-color:#1e0010">└──&gt;</span> <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d815</span>      <span style="color:#ae81ff">837</span><span style="color:#66d9ef">de001</span>       <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>We also notice that the starting material is <code>0x796b159acd626b88 = 8749110455712246664</code>. We also know that the end product is <code>0x656e61627563 = 111524754650467</code> (which is actually Cubane :D).</p>
<p>This is where there are two ways to do this challenge (and where the Chemistry comes in!). We can either analyze each of the functions, determine what they do (and the math behind it), or we can figure out (or Google) the synthesis of Cubane and figure out which reagents we need/reactions to perform. Retrosynthesis! :D</p>
<h4 id="the-math-way">The Math Way</h4>
<p>Here we try to figure out the math behind all 7 of the functions: benzene, NBS, Diels-Alder, SOCl2, decarboxylation, Aldol reaction, and Favorskii reaction. (Small note: All the numbers involved in the math operations actually translate to the chemicals/reactions :DD Chemistry is cool!)</p>
<p><em>Function 1: Benzene</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">[0</span><span style="color:#a6e22e">x7faecf103050</span>]<span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">pdf</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">sym.benzene</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">; CALL XREF from main @ 0x55cb85b3d7ec
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">┌</span> <span style="color:#960050;background-color:#1e0010">28:</span> <span style="color:#a6e22e">sym.benzene</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; var int64_t var_8h @ rbp-0x8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d650</span>      <span style="color:#ae81ff">55</span>             <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d651</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">e5</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d654</span>      <span style="color:#ae81ff">48897</span><span style="color:#66d9ef">df8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rdi</span> <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d658</span>      <span style="color:#ae81ff">48</span><span style="color:#66d9ef">b862656e7a.</span>  <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x656e657a6e6562</span> <span style="color:#75715e">; &#39;benzene&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d662</span>      <span style="color:#ae81ff">480145</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d666</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">b45f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d66a</span>      <span style="color:#ae81ff">5</span><span style="color:#66d9ef">d</span>             <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d66b</span>      <span style="color:#66d9ef">c3</span>             <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>This one is pretty obvious; var_8h contains our starting material, and we can see that 0x656e657a6e6562 is being added to it.</p>
<p><em>Function 2: NBS</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">[0</span><span style="color:#a6e22e">x7faecf103050</span>]<span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">pdf</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">sym.NBS</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">; CALL XREF from main @ 0x55cb85b3d822
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">┌</span> <span style="color:#960050;background-color:#1e0010">22:</span> <span style="color:#a6e22e">sym.NBS</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; var int64_t var_8h @ rbp-0x8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d66c</span>      <span style="color:#ae81ff">55</span>             <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d66d</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">e5</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d670</span>      <span style="color:#ae81ff">48897</span><span style="color:#66d9ef">df8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rdi</span> <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d674</span>      <span style="color:#ae81ff">488145</span><span style="color:#66d9ef">f84e42.</span>  <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">0x53424e</span> <span style="color:#75715e">; [0x53424e:8]=-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d67c</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">b45f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d680</span>      <span style="color:#ae81ff">5</span><span style="color:#66d9ef">d</span>             <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d681</span>      <span style="color:#66d9ef">c3</span>             <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>0x53424e is being added to the number that we have (starting material + 0x656e657a6e6562 if the benzene function is activated, starting material if the benzene function is not activated). From now on the number would be referred to as the result.</p>
<p><em>Function 3: Diels-Alder</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">[0</span><span style="color:#a6e22e">x7faecf103050</span>]<span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">pdf</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">sym.diels</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">; CALL XREF from main @ 0x55cb85b3d858
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">┌</span> <span style="color:#960050;background-color:#1e0010">28:</span> <span style="color:#a6e22e">sym.diels</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; var int64_t var_8h @ rbp-0x8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d682</span>      <span style="color:#ae81ff">55</span>             <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d683</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">e5</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d686</span>      <span style="color:#ae81ff">48897</span><span style="color:#66d9ef">df8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rdi</span> <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d68a</span>      <span style="color:#ae81ff">48</span><span style="color:#66d9ef">b86469656c.</span>  <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x736c656964</span> <span style="color:#75715e">; &#39;diels&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d694</span>      <span style="color:#ae81ff">483145</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d698</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">b45f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d69c</span>      <span style="color:#ae81ff">5</span><span style="color:#66d9ef">d</span>             <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d69d</span>      <span style="color:#66d9ef">c3</span>             <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>If this function is activated, the result will be XORed with 0x736c656964.</p>
<p><em>Function 4: SOCl2</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">[0</span><span style="color:#a6e22e">x7faecf103050</span>]<span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">pdf</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">sym.SOCl2</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">; CALL XREF from main @ 0x55cb85b3d88e
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">┌</span> <span style="color:#960050;background-color:#1e0010">28:</span> <span style="color:#a6e22e">sym.SOCl2</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; var int64_t var_8h @ rbp-0x8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d69e</span>      <span style="color:#ae81ff">55</span>             <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d69f</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">e5</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6a2</span>      <span style="color:#ae81ff">48897</span><span style="color:#66d9ef">df8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rdi</span> <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6a6</span>      <span style="color:#ae81ff">48</span><span style="color:#66d9ef">b8534f436c.</span>  <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x326c434f53</span> <span style="color:#75715e">; &#39;SOCl2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6b0</span>      <span style="color:#ae81ff">480145</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6b4</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">b45f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6b8</span>      <span style="color:#ae81ff">5</span><span style="color:#66d9ef">d</span>             <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6b9</span>      <span style="color:#66d9ef">c3</span>             <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>If this function is activated, 0x326c434f53 will be added to the result.</p>
<p><em>Function 5: Decarboxylation</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">[0</span><span style="color:#a6e22e">x7faecf103050</span>]<span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">pdf</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">sym.decarb</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">; CALL XREF from main @ 0x55cb85b3d8c4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">┌</span> <span style="color:#960050;background-color:#1e0010">28:</span> <span style="color:#a6e22e">sym.decarb</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; var int64_t var_8h @ rbp-0x8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6ba</span>      <span style="color:#ae81ff">55</span>             <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6bb</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">e5</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6be</span>      <span style="color:#ae81ff">48897</span><span style="color:#66d9ef">df8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rdi</span> <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6c2</span>      <span style="color:#ae81ff">48</span><span style="color:#66d9ef">b8d3bcb0b0.</span>  <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0xffffffb7b0b0bcd3</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6cc</span>      <span style="color:#ae81ff">480145</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6d0</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">b45f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6d4</span>      <span style="color:#ae81ff">5</span><span style="color:#66d9ef">d</span>             <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6d5</span>      <span style="color:#66d9ef">c3</span>             <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>If this function is activated, 0xffffffb7b0b0bcd3 would be added to the result, which is the same as 310568239917 being subtracted from the result.</p>
<p><em>Function 6: Aldol reaction</em>
Personally my favourite reaction in Organic Chemistry! :D</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">[0</span><span style="color:#a6e22e">x7faecf103050</span>]<span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">pdf</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">sym.aldol</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">; CALL XREF from main @ 0x55cb85b3d8fa
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">┌</span> <span style="color:#960050;background-color:#1e0010">28:</span> <span style="color:#a6e22e">sym.aldol</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; var int64_t var_8h @ rbp-0x8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6d6</span>      <span style="color:#ae81ff">55</span>             <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6d7</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">e5</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6da</span>      <span style="color:#ae81ff">48897</span><span style="color:#66d9ef">df8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rdi</span> <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6de</span>      <span style="color:#ae81ff">48</span><span style="color:#66d9ef">b8616c646f.</span>  <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x6c6f646c61</span> <span style="color:#75715e">; &#39;aldol&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6e8</span>      <span style="color:#ae81ff">480145</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6ec</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">b45f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6f0</span>      <span style="color:#ae81ff">5</span><span style="color:#66d9ef">d</span>             <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6f1</span>      <span style="color:#66d9ef">c3</span>             <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>If this function is activated, 0x6c6f646c61 would be added to the result.</p>
<p><em>Function 7: Favorskii reaction</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">[0</span><span style="color:#a6e22e">x7faecf103050</span>]<span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">pdf</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">sym.favorsky</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">; CALL XREF from main @ 0x55cb85b3d930
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">┌</span> <span style="color:#960050;background-color:#1e0010">28:</span> <span style="color:#a6e22e">sym.favorsky</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; var int64_t var_8h @ rbp-0x8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6f2</span>      <span style="color:#ae81ff">55</span>             <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6f3</span>      <span style="color:#ae81ff">4889</span><span style="color:#66d9ef">e5</span>         <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6f6</span>      <span style="color:#ae81ff">48897</span><span style="color:#66d9ef">df8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rdi</span> <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d6fa</span>      <span style="color:#ae81ff">48</span><span style="color:#66d9ef">b86661766f.</span>  <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x796b73726f766166</span> <span style="color:#75715e">; &#39;favorsky&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d704</span>      <span style="color:#ae81ff">483145</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d708</span>      <span style="color:#ae81ff">488</span><span style="color:#66d9ef">b45f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d70c</span>      <span style="color:#ae81ff">5</span><span style="color:#66d9ef">d</span>             <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└</span>           <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x55cb85b3d70d</span>      <span style="color:#66d9ef">c3</span>             <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>If this function is activated, the result would be XORed with 0x796b73726f766166.</p>
<p>Knowing how these functions work, you can do a little bit of math and figure out how to get 111524754650467 (Cubane).</p>
<h4 id="the-chem-way-d">The Chem Way :D</h4>
<p>This method is much, much easier than the Math one. All you need to do is to Google the synthesis of Cubane (can be found at <a href="https://www.synarchive.com/syn/14">https://www.synarchive.com/syn/14</a> &ndash; SynArchive is basically Exploit-DB for Chemists).
<img src="https://github.com/KaligulaSec/CTF-Writeups/blob/main/idekCTF%202021/Cubane.png?raw=true" alt="alt text"></p>
<p>Simply by looking at the synthesis, we can figure out that NBS, Diels-Alder reaction, SOCl2 and Favorskii reaction are needed to make Cubane.</p>
<h4 id="patching-the-binary">Patching the binary</h4>
<p>We can patch the binary to switch on the required functions using the almighty radare2. We can open the binary in write mode:</p>
<pre tabindex="0"><code>r2 -w retrosynthesis
</code></pre><p>From looking at the functions, we know that the variables that we have to change to 1 are var_20h, var_24h, var_28h and var_34h. We can do so as such:</p>
<pre tabindex="0"><code>[0x000010e0]&gt; wx c745e0010000 @0x0000172e
[0x000010e0]&gt; wx c745dc010000 @0x00001735
[0x000010e0]&gt; wx c745d8010000 @0x0000173c
[0x000010e0]&gt; wx c745cc010000 @0x00001751
</code></pre><p>Printing the main function again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001719</span>      <span style="color:#ae81ff">48</span><span style="color:#66d9ef">b8886b62cd.</span>  <span style="color:#66d9ef">movabs</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x796b159acd626b88</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001723</span>      <span style="color:#ae81ff">488945</span><span style="color:#66d9ef">f8</span>       <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001727</span>      <span style="color:#66d9ef">c745e4000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_1ch</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000172e</span>      <span style="color:#66d9ef">c745e0010000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001735</span>      <span style="color:#66d9ef">c745dc010000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_24h</span>], <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000173c</span>      <span style="color:#66d9ef">c745d8010000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_28h</span>], <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001743</span>      <span style="color:#66d9ef">c745d4000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_2ch</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000174a</span>      <span style="color:#66d9ef">c745d0000000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_30h</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001751</span>      <span style="color:#66d9ef">c745cc010000.</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_34h</span>], <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>We can see that now the required functions are now activated! Running the binary, we get:</p>
<pre tabindex="0"><code>./retrosynthesis
    ____       __                              __  __              _     
   / __ \___  / /__________  _______  ______  / /_/ /_  ___  _____(_)____
  / /_/ / _ \/ __/ ___/ __ \/ ___/ / / / __ \/ __/ __ \/ _ \/ ___/ / ___/
 / _, _/  __/ /_/ /  / /_/ (__  ) /_/ / / / / /_/ / / /  __(__  ) (__  ) 
/_/ |_|\___/\__/_/   \____/____/\__, /_/ /_/\__/_/ /_/\___/____/_/____/  
                               /____/                                    
-------------------------------------------------------------------------
Note: You do not need to know Chemistry to do this challenge, though it will help :)
---------------------------------STATUS----------------------------------
Math: 28550354772583778 [Not done] | Chem: Benzene [Not added]
Math: 5456462 [Done] | Chem: NBS [Added]
Math: 495739824484 [Done] | Chem: Diels-Alder Reaction [Done]
Math: 216564715347 [Done] | Chem: SOCl2 [Added]
Math: 310568239917 [Not done] | Chem: Decarboxylation [Not done]
Math: 465725320289 [Not done] | Chem: Aldol Reaction [Not done]
Math: 8749213636430815590 [Done] | Chem: Favorskii Reaction [Done]
---------------------------------RESULTS---------------------------------
Starting material: 8749110455712246664
Desired product: 111524754650467 Cubane
Obtained product: 111524754650467
-------------------------------------------------------------------------
You synthesized cubane! :D
idek{y0U_90tt4_ke3p_tr13NE_h47d3r}

                                                       .:
                                                      / )
                                                     ( (
                                                      \ )
      o                                             ._(/_.
       o                                            |___%|
     ___              ___  ___  ___  ___             | %|
     | |        ._____|_|__|_|__|_|__|_|_____.       | %|
     | |        |__________________________|%|       | %|
     |o|          | | |%|  | |  | |  |~| | |        .|_%|.
    .&#39; &#39;.         | | |%|  | |  |~|  |#| | |        | ()%|
   /  o  \        | | :%:  :~:  : :  :#: | |     .__|___%|__.
  :____o__:     ._|_|_.    ._|_|_.   |      ___%|_
  &#39;._____.&#39;     |___|%|                |___|%|   |_____(____  )
                                                           ( (
                                                            \ &#39;._____.-
                                                             &#39;._______.-

-------------------------------------------------------------------------
</code></pre><p>The flag is idek{y0U_90tt4_ke3p_tr13NE_h47d3r} :D</p>
<p>Author note: This was the first CTF challenge I&rsquo;ve ever created; looking back there are ways to cheese this challenge &ndash; you can literally patch the binary to jump to the bit that gives you the flag D: I should have probably made it a flag gen&hellip;
It was still really fun making this though and I hope to make more challs to come :&gt;</p>

    <h4><a href="https://kaligulaarmblessed.github.io">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>
&copy; 

    Kaligula Armblessed

<span id="thisyear">2023</span>


        | Built on <a href="//gohugo.io" target="_blank">Hugo</a>

</p>
    <p class="text-center">
        
        
        
        <a href="https://github.com/KaligulaArmblessed">GitHub</a> 
        
    </p>
</footer>

</body><link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/style.css">

<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: false ,
        onePass: true , 
        speedFactor: 1 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script></html>
